/*
    SPDX-License-Identifier: MIT
    
    Copyright (c) 2024 SparkFun Electronics
*/

#pragma once

#include "main.h"

// Resolution variation lookup tables
const uint8_t numLutIndices = 51;
const int8_t lutIndices[numLutIndices] = {-100,-93,-88,-83,-78,-73,-68,-64,-59,-55,-50,-45,-41,-37,-33,-28,-26,-21,-17,-15,-12,-10,-7,-5,-3,0,3,5,7,10,12,15,17,21,26,28,33,37,41,45,50,55,59,64,68,73,78,83,88,93,100};

// In order to minimize flash size, the lookup tables are stored as 2D arrays of
// 8-bit signed integers, which has a resolution of 0.2% per LSB, and is offset
// by 100%. For example, a value of 0 in the lookup table corresponds to a 100%
// scaling factor, and a value of 1 corresponds to 100.2%
const float lutResolution = 0.002f;

const int8_t xResVarLut[numLutIndices][numLutIndices] =
{
    {83,97,101,92,56,52,52,52,45,45,48,45,43,52,36,53,62,19,50,72,52,-5,36,77,114,125,113,62,10,-3,51,72,50,19,60,50,32,51,46,42,48,45,45,48,49,51,49,51,51,55,76},
    {94,93,68,42,42,42,64,46,43,43,39,38,43,39,27,50,62,15,49,68,50,-5,21,81,115,125,105,68,14,7,50,64,48,14,54,46,29,42,40,33,41,44,39,44,44,44,49,45,50,53,53},
    {52,49,51,44,54,51,41,41,43,39,43,34,40,42,29,44,50,12,47,68,43,-2,28,91,122,125,119,50,16,11,53,65,45,14,49,41,28,42,33,36,39,37,42,42,39,41,43,41,43,46,46},
    {67,54,43,46,39,35,39,40,37,39,36,32,34,33,24,41,47,13,42,66,42,-2,34,80,122,125,111,53,27,-7,42,65,41,16,42,42,29,34,37,34,34,36,35,40,40,38,42,40,42,50,49},
    {56,57,53,36,42,38,36,39,34,32,36,28,29,34,20,35,44,10,44,65,52,-4,28,76,121,125,110,59,23,1,48,62,42,13,42,40,21,37,36,30,34,30,35,34,33,35,37,38,40,45,48},
    {41,35,33,36,36,36,36,35,36,36,31,30,24,26,23,30,37,12,38,55,46,-1,22,70,115,125,112,70,18,-1,39,54,40,12,36,35,23,30,27,30,31,31,31,32,33,35,32,35,46,39,47},
    {33,31,33,33,32,34,35,36,31,32,29,20,28,22,14,31,30,10,39,56,37,-10,19,71,122,125,111,53,25,-9,28,52,37,6,33,33,15,25,29,24,31,31,28,33,30,32,32,33,35,35,41},
    {35,30,31,32,31,33,34,36,34,30,34,23,25,30,20,31,36,13,32,50,38,6,18,66,123,125,105,59,14,2,39,52,34,8,35,30,20,30,24,25,33,25,31,31,28,29,30,32,34,33,37},
    {33,30,30,30,31,31,33,33,32,28,25,24,23,19,18,24,23,9,25,34,19,-9,8,44,106,125,98,44,8,-9,19,37,24,2,19,18,17,19,25,25,24,29,27,29,29,29,27,28,30,28,33},
    {31,29,30,29,31,30,30,32,28,27,26,20,25,22,17,28,28,4,26,36,9,-12,5,43,109,125,95,40,3,-16,14,38,22,3,24,26,13,23,28,19,29,26,23,30,26,26,26,27,27,26,29},
    {28,31,30,31,28,29,30,29,29,27,28,27,24,26,26,21,23,11,19,27,9,-8,7,32,94,125,89,38,12,-10,13,26,18,10,24,20,22,25,23,28,28,26,28,27,27,27,27,25,25,25,29},
    {27,28,27,27,26,24,23,22,21,22,20,21,22,14,13,15,4,-1,8,12,-9,-23,-9,21,80,125,67,26,-6,-26,-3,12,11,-3,9,14,12,12,21,20,18,22,21,22,22,23,24,22,22,26,27},
    {33,24,29,26,26,26,23,25,24,23,29,25,29,28,23,21,21,5,13,18,1,-18,-3,30,93,125,84,34,-9,-16,1,21,17,11,24,24,21,30,25,22,27,22,24,24,22,23,23,23,24,22,27},
    {29,30,29,26,25,24,23,21,21,22,23,24,24,21,20,10,10,6,6,6,-2,-17,4,17,73,125,57,20,-7,-17,-5,12,8,9,13,15,21,21,20,21,21,20,22,21,20,23,23,23,25,25,27},
    {28,24,19,19,17,14,14,13,13,15,11,15,14,11,10,1,-1,-1,1,-0,-16,-23,-6,19,77,125,67,20,-10,-25,-12,2,2,-0,-1,6,13,9,16,13,11,14,12,13,14,13,15,16,16,17,19},
    {28,27,26,25,24,26,21,23,24,22,26,26,25,25,24,17,19,20,17,22,20,7,15,44,96,125,91,35,16,7,19,25,19,23,23,25,31,26,23,24,24,20,24,22,20,22,22,23,24,25,28},
    {30,30,29,27,25,26,24,22,24,23,22,26,21,17,22,16,14,17,16,18,16,4,17,33,84,125,79,26,19,7,17,22,17,23,16,15,25,23,25,24,20,22,22,20,22,23,23,26,27,30,31},
    {13,11,11,9,9,6,8,6,6,7,4,8,4,-1,7,-4,-4,4,1,5,1,-5,11,23,67,125,70,23,7,-6,7,7,6,6,4,1,10,5,7,7,2,5,4,4,6,4,7,7,10,10,14},
    {21,21,21,18,21,21,18,20,20,17,20,21,14,17,24,20,23,31,33,41,51,44,37,66,109,125,107,61,37,42,51,47,34,35,28,27,25,26,21,20,18,14,18,17,15,18,18,20,22,22,24},
    {32,33,26,24,25,26,22,23,24,22,22,24,15,16,29,21,26,38,36,45,55,49,51,61,102,125,105,61,47,53,55,46,40,44,32,28,30,27,20,24,18,21,23,21,22,23,23,26,27,29,28},
    {30,21,23,18,15,16,13,13,13,11,9,12,1,7,10,10,12,26,28,32,43,42,42,47,90,125,91,51,40,42,47,34,30,32,21,16,19,9,12,14,6,7,12,12,13,14,15,14,19,20,29},
    {9,9,10,8,9,7,7,5,6,5,4,6,-4,4,7,1,6,22,18,22,32,28,30,39,77,125,81,39,32,32,36,24,22,26,12,8,15,3,3,8,0,-0,4,3,6,5,7,7,8,9,12},
    {20,17,17,16,17,15,14,14,12,12,11,10,5,10,10,14,17,26,32,36,44,34,34,61,102,125,104,61,38,35,49,38,37,32,22,22,20,11,12,12,6,7,10,12,14,13,17,15,16,18,20},
    {19,16,18,15,16,15,14,13,13,12,11,10,4,12,12,16,22,35,35,46,61,54,42,56,108,125,119,78,46,57,63,51,43,41,28,25,21,12,14,14,7,8,12,13,13,15,16,16,18,17,21},
    {18,17,17,16,15,15,14,13,14,12,11,13,5,13,13,15,23,38,38,42,56,56,46,49,48,125,53,66,54,60,65,48,40,45,27,24,24,13,13,14,7,9,13,12,15,15,15,16,18,19,20},
    {17,16,16,14,14,12,15,11,13,11,11,11,3,11,13,10,15,35,28,35,50,48,38,44,17,125,51,55,45,50,54,37,31,40,19,14,21,10,5,14,8,11,14,11,14,14,15,16,17,17,17},
    {21,19,19,17,18,15,16,16,16,14,13,14,6,15,16,15,24,38,40,46,57,53,49,50,42,125,68,67,53,58,63,47,41,44,29,23,25,14,14,15,8,10,14,13,16,17,16,17,19,18,20},
    {19,18,19,16,16,13,14,14,14,12,13,11,5,13,13,18,25,35,37,46,61,54,42,61,96,125,114,71,47,58,64,47,43,41,29,25,22,14,14,14,7,8,13,14,13,14,16,16,17,18,19},
    {20,18,18,15,15,14,13,14,12,11,10,12,4,10,11,15,18,29,31,36,43,32,32,55,92,125,103,63,41,37,48,38,37,31,23,23,21,11,15,14,6,8,12,13,14,14,16,16,19,19,20},
    {11,8,8,8,7,6,6,4,6,6,4,5,-4,4,6,3,6,25,18,22,34,30,30,35,79,125,82,45,33,34,37,27,21,26,13,9,16,5,2,9,3,2,6,6,8,8,9,9,9,9,11},
    {28,23,22,18,16,16,15,14,14,12,11,13,2,9,14,13,15,27,28,36,46,40,42,48,88,125,95,55,45,44,46,36,31,34,20,17,20,9,12,14,7,9,13,13,16,17,19,18,24,21,26},
    {31,29,28,26,25,26,24,22,25,22,23,27,17,20,31,23,29,40,40,46,58,52,48,62,100,125,108,67,50,51,61,45,41,45,30,29,30,28,22,26,19,23,26,25,25,27,27,28,28,28,31},
    {25,24,22,20,20,20,18,20,22,17,21,21,16,20,27,22,25,33,36,43,54,42,35,64,105,125,113,71,42,45,55,47,37,37,30,28,26,28,23,22,19,17,21,21,21,23,21,24,24,24,24},
    {15,12,11,10,9,8,8,6,7,8,6,11,5,2,10,-1,1,7,7,7,4,-9,7,21,65,125,82,32,17,-0,6,9,8,8,4,2,11,8,10,10,5,8,7,6,10,9,11,13,12,12,16},
    {34,30,29,26,26,26,25,23,25,24,25,26,26,21,25,18,20,19,21,21,16,7,18,25,81,125,87,49,25,11,23,22,19,26,18,18,27,25,25,28,22,24,26,26,28,28,29,30,31,32,34},
    {29,29,28,26,24,25,21,24,27,24,28,28,28,28,27,22,25,25,20,28,21,11,13,33,91,125,103,53,25,15,25,28,23,26,23,27,32,30,27,28,28,25,28,26,26,30,28,28,28,30,31},
    {21,20,20,18,18,16,17,17,14,17,15,20,19,14,13,8,5,1,5,4,-12,-26,-7,19,60,125,87,28,4,-18,-7,5,9,4,3,8,14,13,18,17,16,19,17,19,18,17,21,21,24,24,23},
    {31,26,26,28,27,27,25,24,26,25,25,28,27,24,25,17,16,12,9,12,-2,-17,-1,20,60,125,84,33,11,-10,2,12,13,12,13,17,23,27,25,28,26,26,27,26,27,28,29,31,33,32,33},
    {29,28,28,27,27,29,27,30,28,27,32,29,33,35,27,26,27,15,21,25,-3,-13,-3,36,86,125,101,41,6,-9,9,26,22,15,28,27,27,33,31,29,34,28,28,30,27,33,32,31,34,33,33},
    {31,28,29,27,30,27,27,28,27,28,24,25,28,17,20,19,13,0,17,14,-2,-22,-2,29,62,125,86,30,7,-16,5,19,16,4,13,19,18,18,27,25,24,28,25,29,29,28,33,33,34,33,33},
    {34,29,31,31,32,31,32,32,34,31,33,35,30,33,30,27,27,14,25,27,19,-7,9,40,79,125,105,46,17,0,19,35,26,17,30,27,29,29,29,32,35,32,34,35,35,36,34,37,38,35,36},
    {34,31,32,31,32,34,33,35,30,33,35,27,36,28,20,33,30,8,30,41,9,-10,14,50,99,125,119,57,15,-4,23,47,39,10,35,35,21,28,33,27,33,34,32,39,35,38,37,36,37,37,35},
    {40,38,36,35,34,34,36,35,34,35,28,32,32,23,24,27,24,12,32,39,24,-5,18,49,77,125,113,67,18,3,26,41,34,15,31,33,25,27,31,31,31,38,36,39,39,39,38,40,39,37,38},
    {43,40,38,37,36,37,36,36,37,35,40,35,35,38,29,39,44,15,41,59,38,3,16,51,109,125,125,78,29,15,58,63,47,25,45,40,27,38,31,32,40,38,42,44,41,41,39,39,38,38,40},
    {44,42,40,40,38,39,38,38,35,39,39,32,38,32,23,41,42,11,43,62,26,-4,22,73,108,125,122,88,34,4,44,68,46,17,42,43,24,31,36,30,39,41,38,45,42,42,41,39,41,39,44},
    {51,52,44,42,42,40,41,40,40,42,38,41,36,37,29,40,45,17,47,64,39,4,23,59,105,125,123,82,42,9,57,72,47,26,46,42,32,35,35,39,41,44,47,44,48,45,45,43,43,43,47},
    {73,59,49,46,45,45,41,44,42,39,44,38,42,42,31,47,54,21,50,66,39,6,28,72,99,125,125,102,43,11,63,77,57,21,55,47,31,43,43,37,47,44,45,47,45,49,45,45,44,46,46},
    {58,59,59,58,53,48,45,46,46,46,42,39,45,40,38,51,53,26,52,68,52,8,25,60,108,125,124,95,41,10,54,81,57,27,56,49,37,43,43,42,47,47,47,53,52,50,48,48,47,54,52},
    {66,72,86,60,53,53,50,50,51,44,48,43,44,50,37,54,61,27,53,72,68,9,31,56,99,125,125,93,42,14,58,84,59,26,67,56,39,53,52,48,53,50,51,51,51,54,50,53,51,57,51},
    {80,72,70,66,57,55,58,54,49,50,49,46,46,54,38,56,65,25,53,77,67,11,26,51,110,125,120,102,46,5,62,84,61,25,70,66,44,58,57,54,53,52,54,53,54,57,55,53,60,57,59},
    {84,85,92,99,99,69,72,65,59,55,55,49,51,60,47,59,67,28,59,76,70,11,35,51,116,125,123,83,57,13,81,94,66,35,80,70,51,64,62,62,59,62,60,57,57,62,62,62,61,60,77},
};
const int8_t yResVarLut[numLutIndices][numLutIndices] =
{
    {79,94,98,86,45,41,41,40,31,28,28,25,24,27,17,22,25,9,16,21,18,8,15,15,15,12,15,15,13,9,17,21,19,10,26,23,15,25,26,26,28,31,32,34,38,38,38,42,42,44,70},
    {91,88,64,37,32,32,55,33,31,26,23,23,23,22,14,19,22,7,15,18,14,6,10,13,12,11,14,13,13,6,15,22,18,8,22,19,15,21,21,23,25,29,30,32,31,35,37,38,41,45,48},
    {50,45,47,39,48,39,30,29,28,26,25,21,23,21,14,19,20,5,14,19,12,4,12,13,13,10,14,13,12,6,17,20,16,8,22,20,13,21,21,22,24,27,31,30,30,32,34,33,40,41,43},
    {65,53,38,41,33,29,28,28,26,24,24,19,17,18,11,19,19,5,13,18,12,4,9,12,11,10,13,10,11,4,14,19,15,6,21,19,14,20,21,20,24,23,25,30,31,31,35,33,37,47,49},
    {55,58,50,31,37,31,30,28,25,22,20,18,18,18,12,17,19,5,15,18,14,3,10,11,13,9,12,11,10,4,14,18,14,6,20,18,12,19,20,20,22,22,25,25,26,26,31,36,37,41,48},
    {41,33,33,33,31,30,29,29,23,24,23,13,18,17,9,18,20,2,14,18,12,4,9,10,11,9,11,12,9,2,11,18,13,3,16,20,10,18,20,17,22,22,22,26,25,29,30,31,43,39,51},
    {32,28,31,31,29,29,29,28,27,21,20,15,15,16,10,14,16,5,12,18,10,3,8,9,10,9,9,8,8,2,10,16,12,4,17,14,10,16,17,18,20,22,24,21,22,29,27,30,33,37,44},
    {39,31,29,28,30,28,31,30,27,27,21,15,17,14,10,17,18,2,14,16,7,1,6,9,9,5,8,7,8,-0,9,16,12,2,17,16,8,14,18,17,21,24,22,23,26,25,29,29,37,36,41},
    {36,31,31,28,27,31,27,29,26,18,22,13,19,15,7,19,19,2,13,18,8,1,6,7,8,6,9,7,5,-1,8,16,11,1,17,18,7,16,18,13,22,19,22,26,23,25,25,29,31,30,38},
    {34,32,31,32,29,29,29,26,25,20,20,16,18,16,11,17,17,2,11,15,5,-1,4,4,6,4,5,4,4,-0,6,13,11,2,16,15,8,15,17,18,18,21,23,23,24,27,25,29,30,31,37},
    {35,34,34,32,33,28,25,30,21,22,22,14,22,18,8,20,16,-0,12,12,2,-7,1,2,2,-1,2,2,-0,-4,3,13,11,-2,15,19,6,14,22,13,23,23,19,28,27,26,29,26,32,32,36},
    {35,35,31,30,23,29,20,21,21,15,25,15,19,17,11,20,16,3,12,15,3,-1,0,2,5,5,5,4,4,1,6,16,12,1,18,20,9,18,16,14,22,15,22,23,22,28,24,28,29,30,31},
    {42,35,36,33,30,23,27,24,19,20,19,18,22,18,9,16,12,-3,9,10,-2,-6,-1,1,0,-2,1,2,1,-6,1,11,11,-2,14,18,8,15,21,17,17,22,21,21,25,24,31,32,28,31,34},
    {42,40,42,32,33,28,18,24,15,19,21,9,26,15,4,19,13,-3,12,13,2,-3,1,5,4,3,4,4,3,-3,3,14,15,-2,14,19,3,16,23,6,21,17,14,28,22,28,32,27,37,37,40},
    {35,30,19,23,13,19,10,14,11,9,18,8,19,17,4,18,19,4,17,19,10,7,7,13,12,14,14,12,9,6,11,20,19,6,16,22,6,15,15,8,18,9,13,15,11,17,17,25,20,18,22},
    {49,46,44,40,37,28,29,26,21,24,16,10,19,6,-2,12,11,-5,15,15,6,-0,8,13,10,6,11,14,9,-1,7,15,16,-3,11,19,3,10,17,9,18,23,18,26,30,31,35,34,39,39,46},
    {58,57,54,44,43,36,28,29,17,23,20,4,20,5,-6,16,9,-7,21,19,9,4,11,18,16,12,16,19,11,4,10,21,20,-2,11,17,-1,9,20,8,17,21,17,32,32,33,41,40,48,53,58},
    {14,7,7,1,-2,4,-5,2,-2,-5,3,-7,-2,-4,-9,11,11,-1,24,33,20,17,21,29,33,30,33,30,23,18,23,33,26,0,15,15,-6,4,2,-8,1,-2,-4,-1,-5,-0,0,6,3,6,7},
    {51,48,46,40,36,31,26,23,18,22,17,10,5,-1,1,12,12,2,28,30,21,15,28,35,29,26,30,32,27,15,21,35,29,6,16,19,1,10,16,14,14,18,19,26,28,31,31,34,38,43,44},
    {85,69,65,63,57,55,50,43,27,32,23,13,11,2,-0,20,16,4,40,40,30,21,35,43,38,31,40,42,30,23,32,43,41,11,23,30,1,15,24,11,20,34,36,45,51,45,53,59,60,68,76},
    {80,41,52,33,22,27,14,28,11,4,-1,-13,-17,-12,-23,13,9,-3,52,52,39,34,42,57,54,50,59,59,38,36,44,49,54,7,19,18,-14,-9,2,-5,2,1,6,26,11,18,27,13,40,42,77},
    {-6,-8,-16,-20,-26,-28,-29,-23,-27,-30,-21,-36,-41,-33,-41,-9,-9,-16,28,41,28,18,23,47,42,34,49,48,25,23,30,43,31,-12,-0,-3,-30,-26,-29,-35,-26,-36,-27,-19,-25,-17,-20,-24,-14,-20,-16},
    {32,26,25,17,19,13,4,-1,-7,-8,-8,-12,-21,-8,-15,-2,3,3,24,36,31,27,24,36,39,34,44,39,31,24,35,38,32,7,15,12,-10,-8,-10,-8,0,-4,0,7,7,14,3,3,-2,8,4},
    {84,80,80,71,74,67,58,65,58,43,40,25,16,16,11,36,33,25,57,57,49,40,54,53,45,51,64,76,58,42,53,64,65,29,39,45,32,31,40,32,41,46,43,45,55,49,42,44,54,54,61},
    {116,111,115,114,119,115,104,118,109,120,112,101,106,93,85,99,99,93,121,108,95,94,111,112,52,39,60,123,111,100,106,118,120,99,108,115,105,96,112,101,105,110,106,113,110,103,106,103,97,105,99},
    {125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125},
    {116,118,112,118,111,116,114,125,114,121,119,108,114,107,106,118,108,94,119,119,104,95,107,115,51,51,72,120,107,92,97,105,113,77,87,92,78,64,87,74,88,90,82,91,94,84,95,99,100,107,95},
    {82,71,75,64,71,70,69,68,62,63,64,42,45,39,28,44,44,30,64,64,52,42,54,59,44,47,54,67,54,41,46,56,59,22,29,34,11,0,9,9,15,19,24,31,36,41,50,41,44,41,37},
    {24,25,29,28,24,24,22,21,15,9,12,4,-9,-4,-12,7,18,7,31,41,34,24,27,37,42,32,38,37,31,24,33,37,28,2,6,3,-16,-15,-22,-26,-26,-30,-22,-17,-12,-9,-10,6,4,1,10},
    {8,-11,-9,-17,-11,-4,-15,-10,-17,-22,-18,-29,-25,-19,-34,-3,0,-10,35,41,31,24,25,44,45,40,51,49,27,24,32,41,30,-14,-3,-1,-40,-34,-39,-40,-29,-43,-36,-36,-45,-35,-40,-36,-30,-39,-23},
    {93,59,63,43,38,31,21,33,14,14,14,-2,-8,-6,-11,19,13,2,50,55,42,37,40,60,58,44,57,62,40,33,42,54,48,2,17,16,-19,-14,-8,-21,-9,-7,-1,15,6,12,23,8,39,27,48},
    {87,80,74,60,61,55,54,52,38,39,28,18,18,11,4,25,21,3,43,42,34,21,34,43,40,32,42,45,31,22,32,40,41,6,16,24,-3,7,18,9,12,24,24,38,39,42,54,52,57,60,70},
    {56,54,47,44,42,39,40,35,27,26,19,15,13,4,4,14,14,5,31,32,25,17,28,37,34,26,33,35,28,17,24,34,29,4,16,18,0,7,11,9,11,18,15,19,23,25,28,37,37,41,41},
    {16,15,13,12,10,10,-1,5,3,1,10,-3,2,3,-6,14,14,2,29,36,23,20,21,32,36,34,38,34,24,21,27,35,29,3,17,19,-7,2,3,-8,-2,-7,-4,-2,-5,-1,-6,-1,1,1,10},
    {64,58,54,46,47,37,36,38,20,24,23,8,22,9,-1,20,14,-4,25,22,13,6,14,20,19,15,18,22,14,7,12,23,22,-1,11,19,-4,8,22,5,16,21,14,29,26,33,42,40,49,49,53},
    {52,49,46,39,41,33,37,29,22,27,23,13,24,13,2,17,14,-2,19,19,10,1,11,16,15,10,15,17,11,4,10,18,18,-3,12,19,4,9,19,9,16,23,19,25,27,27,37,37,41,46,44},
    {28,26,27,28,22,24,14,20,18,12,23,16,23,21,8,26,23,8,22,25,13,8,12,16,16,18,17,16,13,10,15,25,22,7,20,23,8,18,19,8,20,8,13,17,11,18,13,21,19,25,27},
    {52,37,41,35,38,33,29,31,19,24,26,12,32,19,9,23,19,3,18,19,6,2,7,10,9,8,10,9,6,2,7,17,18,1,17,23,5,20,27,10,21,21,16,27,21,27,35,31,41,34,40},
    {38,41,33,36,35,32,32,29,27,29,22,23,27,21,13,22,19,1,16,16,3,-1,5,6,5,3,5,6,4,-2,4,15,15,2,16,22,10,19,24,21,23,25,22,27,29,27,32,33,38,40,36},
    {37,35,37,36,31,32,26,28,29,21,28,21,23,24,15,26,23,8,17,21,9,6,7,8,9,10,11,8,7,5,11,20,16,6,23,25,13,22,22,17,26,20,22,24,24,31,26,33,33,35,35},
    {48,38,41,34,39,31,32,34,25,30,28,20,30,23,13,24,21,6,20,19,9,0,6,7,7,6,8,7,5,-1,7,17,16,2,21,24,11,20,27,17,26,27,23,33,30,33,37,34,38,33,38},
    {43,38,33,37,34,36,33,30,31,28,27,25,24,22,16,22,24,8,18,21,11,6,11,10,12,9,11,11,9,5,11,20,17,8,23,22,15,21,22,22,25,26,29,31,32,34,33,36,33,35,33},
    {50,43,38,38,32,34,31,32,29,25,28,21,27,23,14,26,24,8,20,24,15,8,11,14,14,14,15,14,11,6,14,23,19,7,23,24,14,21,24,18,29,27,29,35,31,37,31,34,37,34,38},
    {51,45,41,39,35,33,36,31,28,31,28,25,26,24,16,25,25,8,21,24,15,7,14,14,15,12,16,15,14,6,16,23,21,10,24,23,17,21,22,22,27,31,31,35,35,35,36,35,33,38,39},
    {52,46,41,40,34,37,32,28,31,30,31,26,26,23,18,24,25,11,20,24,18,10,16,17,18,15,18,16,16,11,17,24,19,11,24,22,16,22,21,21,28,28,33,33,33,35,35,37,35,36,42},
    {56,53,43,40,41,36,34,34,31,32,30,25,28,27,18,28,28,11,22,28,20,11,16,18,19,17,18,19,17,11,20,28,22,12,25,26,15,23,25,22,31,29,32,37,38,36,37,37,40,39,43},
    {73,59,46,44,40,39,36,36,34,32,31,29,30,28,21,27,29,13,23,29,19,13,19,20,19,19,20,20,19,12,22,27,23,12,27,25,20,25,27,26,30,33,35,33,38,38,36,38,37,42,41},
    {59,59,58,54,47,41,38,38,36,32,33,27,29,28,23,29,32,16,24,30,24,14,20,21,20,20,20,21,17,12,21,29,23,14,28,25,21,26,27,27,31,32,35,37,38,42,39,40,40,50,47},
    {65,71,83,55,47,45,43,40,40,37,33,31,31,32,25,30,33,19,27,31,27,17,21,23,23,23,23,22,19,15,23,27,23,15,29,27,22,29,31,30,33,34,36,37,38,41,42,44,43,48,47},
    {77,68,63,60,49,47,44,43,42,37,36,33,31,33,24,31,34,18,27,31,27,17,23,23,23,21,22,21,21,14,23,28,23,15,31,30,25,33,33,35,35,35,39,39,40,43,43,45,50,49,51},
    {81,80,87,96,95,59,63,55,47,41,37,35,33,35,29,32,35,23,30,33,28,19,26,25,24,25,24,25,24,18,28,31,26,17,36,33,28,35,34,37,39,41,39,41,41,47,47,50,53,51,71},
};

// Helper function to interpolate a value from a lookup table
bool bilinearInterp(float inX, float inY, float &outX, float &outY)
{
    // Convert input values to integers so we don't have to do floating point
    // comparisons for finding the right index into the lookup table
    int8_t inXInt = inX;
    int8_t inYInt = inY;

    // We want the integer values to be rounded down from the input values. This
    // happens automatically for positive values due to truncation, but negative
    // values are rounded up towards zero. To fix this, we can just subtract 1
    if (inX < 0)
        inXInt--;
    if (inY < 0)
        inYInt--;

    // Check if the input values are within the bounds of the lookup table
    if (inXInt < lutIndices[0] || inXInt >= lutIndices[numLutIndices - 1] || inYInt < lutIndices[0] ||
        inYInt >= lutIndices[numLutIndices - 1])
    {
        // Input values are out of bounds
        return false;
    }

    // Binary search to find the correct x index
    uint8_t low = 0;
    uint8_t high = numLutIndices - 1;
    uint8_t i = 0;
    while (low <= high)
    {
        // New midpoint
        i = (low + high) / 2;

        // Check if we're low or high
        if (lutIndices[i] < inXInt)
            low = i + 1;
        else if (lutIndices[i] > inXInt)
            high = i - 1;
        else
            break;
    }

    // Binary search to find the correct y index
    low = 0;
    high = numLutIndices - 1;
    uint8_t j = 0;
    while (low <= high)
    {
        // New midpoint
        j = (low + high) / 2;

        // Check if we're low or high
        if (lutIndices[j] < inYInt)
            low = j + 1;
        else if (lutIndices[j] > inYInt)
            high = j - 1;
        else
            break;
    }

    // Get the coordinates of the four corners of the square around the input
    float x1 = lutIndices[i];
    float y1 = lutIndices[j];
    float x2 = lutIndices[i + 1];
    float y2 = lutIndices[j + 1];

    // Pre-compute the denominator inverse for the bilinear interpolation
    float denomInv = 1.0f / ((x2 - x1) * (y2 - y1));

    // Pre-compute the difference between the input and bounds
    float dx1 = inX - x1;
    float dy1 = inY - y1;
    float dx2 = x2 - inX;
    float dy2 = y2 - inY;

    // Pre-compute the product of the differences
    float dx1dy1 = dx1 * dy1;
    float dx2dy1 = dx2 * dy1;
    float dx1dy2 = dx1 * dy2;
    float dx2dy2 = dx2 * dy2;

    // Get the values of the four corners of the square around the input for the
    // x lookup table
    float q11 = xResVarLut[j][i];
    float q12 = xResVarLut[j][i + 1];
    float q21 = xResVarLut[j + 1][i];
    float q22 = xResVarLut[j + 1][i + 1];

    // Bilinear interpolation for the x lookup table
    outX = (q11 * dx2dy2 + q21 * dx1dy2 + q12 * dx2dy1 + q22 * dx1dy1) * denomInv;

    // Get the values of the four corners of the square around the input for the
    // y lookup table
    q11 = yResVarLut[j][i];
    q12 = yResVarLut[j][i + 1];
    q21 = yResVarLut[j + 1][i];
    q22 = yResVarLut[j + 1][i + 1];

    // Bilinear interpolation for the y lookup table
    outY = (q11 * dx2dy2 + q21 * dx1dy2 + q12 * dx2dy1 + q22 * dx1dy1) * denomInv;

    // Adjust scale of outputs
    outX = (outX * lutResolution) + 1.0f;
    outY = (outY * lutResolution) + 1.0f;

    // Done!
    return true;
}
